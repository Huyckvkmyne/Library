local MarketplaceService = game:GetService("MarketplaceService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local PlayerMouse = Player:GetMouse()

local bearlib = {
    Themes = {
        DarkBlue = {
            ["Color Hub 1"] = ColorSequence.new({
                ColorSequenceKeypoint.new(0.00, Color3.fromRGB(0, 50, 100)),
                ColorSequenceKeypoint.new(0.50, Color3.fromRGB(0, 20, 60)),
                ColorSequenceKeypoint.new(1.00, Color3.fromRGB(0, 0, 30))
            }),
            ["Color Hub 2"] = Color3.fromRGB(5, 5, 15),
            ["Color Stroke"] = Color3.fromRGB(0, 150, 255),
            ["Color Theme"] = Color3.fromRGB(0, 200, 255),
            ["Color Text"] = Color3.fromRGB(220, 240, 255),
            ["Color Dark Text"] = Color3.fromRGB(150, 180, 200),
            ["Color Discord Text"] = Color3.fromRGB(220, 240, 255),
            ["Color Discord Stats"] = Color3.fromRGB(180, 220, 255)
        }
    },
    Info = {
        Version = "2.2.0"
    },
    Save = {
        UISize = {550, 380},
        TabSize = 160,
        Theme = "DarkBlue"
    },
    Settings = {},
    Connection = {},
    Instances = {},
    Elements = {},
    Options = {},
    Flags = {},
    Tabs = {},
    Icons = {},
    AllElements = {},
    SaveEnabled = true,
    SaveFile = "BearHub_Settings.json"
}

local ViewportSize = workspace.CurrentCamera.ViewportSize
local UIScale = ViewportSize.Y / 450
local Settings = bearlib.Settings
local Flags = bearlib.Flags

-- Hệ thống lưu
function bearlib:EnableSaving(enable)
    self.SaveEnabled = enable
    return self
end

function bearlib:SetSaveFile(filename)
    if type(filename) == "string" and #filename > 0 then
        self.SaveFile = filename
    end
    return self
end

local function SaveJson(FileName, save)
    if not bearlib.SaveEnabled or not writefile then return false end
    local success, json = pcall(function() return HttpService:JSONEncode(save) end)
    if success then
        pcall(function() writefile(FileName, json) end)
        return true
    end
    return false
end

local function LoadJson(FileName)
    if not readfile or not isfile then return nil end
    local success, exists = pcall(isfile, FileName)
    if not success or not exists then return nil end
    local success, content = pcall(readfile, FileName)
    if not success then return nil end
    local success, decoded = pcall(function() return HttpService:JSONDecode(content) end)
    return success and decoded or nil
end

local function Create(...)
    local args = {...}
    if type(args) ~= "table" then return end
    local new = Instance.new(args[1])
    if type(args[2]) == "table" then
        for prop, value in pairs(args[2]) do
            new[prop] = value
        end
    end
    if type(args[3]) == "table" then
        for _, child in pairs(args[3]) do
            child.Parent = new
        end
    end
    return new
end

local ScreenGui = Create("ScreenGui", CoreGui, {
    Name = "BearHub_DarkBlue",
    ZIndexBehavior = Enum.ZIndexBehavior.Sibling
}, {
    Create("UIScale", {Scale = UIScale, Name = "Scale"})
})

local ScreenFind = CoreGui:FindFirstChild(ScreenGui.Name)
if ScreenFind and ScreenFind ~= ScreenGui then
    ScreenFind:Destroy()
end

local Theme = bearlib.Themes[bearlib.Save.Theme]

local function AddCorner(instance, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 7)
    corner.Parent = instance
end

local function AddStroke(instance, color, thickness)
    local stroke = Instance.new("UIStroke")
    stroke.Color = color or Theme["Color Stroke"]
    stroke.Thickness = thickness or 1
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Parent = instance
end

local function MakeDrag(Instance)
    task.spawn(function()
        Instance.Active = true
        Instance.AutoButtonColor = false
        
        local DragStart, StartPos, InputOn
        
        local function Update(input)
            local delta = input.Position - DragStart
            Instance.Position = UDim2.new(
                StartPos.X.Scale, StartPos.X.Offset + delta.X / UIScale,
                StartPos.Y.Scale, StartPos.Y.Offset + delta.Y / UIScale
            )
        end
        
        Instance.InputBegan:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.MouseButton1 then
                StartPos = Instance.Position
                DragStart = Input.Position
                InputOn = true
                
                while UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) do
                    RunService.Heartbeat:Wait()
                    if InputOn then Update(Input) end
                end
                InputOn = false
            end
        end)
    end)
    return Instance
end

-- ==================== MAIN WINDOW ====================
function bearlib:MakeWindow(Configs)
    local WTitle = Configs[1] or Configs.Name or Configs.Title or "Bear Hub"
    local WMiniText = Configs[2] or Configs.SubTitle or "by Quang Huy"
    local SaveFolder = Configs[3] or Configs.SaveFolder or false
    
    if type(SaveFolder) == "string" then
        Settings.ScriptFile = SaveFolder
        self:SetSaveFile(SaveFolder)
        self:EnableSaving(true)
    elseif SaveFolder == false then
        self:EnableSaving(false)
        Settings.ScriptFile = nil
    end
    
    if self.SaveEnabled then
        local decoded = LoadJson(self.SaveFile)
        if type(decoded) == "table" then
            Flags = decoded
        end
    end
    
    local UISizeX, UISizeY = unpack(bearlib.Save.UISize)
    
    local MainFrame = Create("ImageButton", ScreenGui, {
        Size = UDim2.fromOffset(UISizeX, UISizeY),
        Position = UDim2.new(0.5, -UISizeX/2, 0.5, -UISizeY/2),
        BackgroundColor3 = Theme["Color Hub 2"],
        BackgroundTransparency = 0.03,
        ClipsDescendants = true,
        Name = "Hub",
        ZIndex = 1
    })
    AddCorner(MainFrame, 12)
    AddStroke(MainFrame, Theme["Color Stroke"], 1.5)
    MakeDrag(MainFrame)
    
    -- TopBar
    local TopBar = Create("Frame", MainFrame, {
        Size = UDim2.new(1, 0, 0, 35),
        BackgroundColor3 = Theme["Color Hub 2"],
        BackgroundTransparency = 0.2,
        Name = "TopBar",
        ZIndex = 20
    })
    AddCorner(TopBar, 12)
    
    local Title = Create("TextLabel", TopBar, {
        Position = UDim2.new(0, 15, 0.5),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0.5, 0, 0.8, 0),
        Text = WTitle,
        TextXAlignment = "Left",
        TextSize = 16,
        TextColor3 = Theme["Color Text"],
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamBold,
        Name = "Title",
        ZIndex = 21
    })
    
    local SubTitle = Create("TextLabel", Title, {
        Position = UDim2.new(1, 5, 1, -2),
        AnchorPoint = Vector2.new(0, 1),
        Size = UDim2.new(0, 200, 0, 14),
        Text = WMiniText,
        TextColor3 = Theme["Color Dark Text"],
        BackgroundTransparency = 1,
        TextXAlignment = "Left",
        TextSize = 10,
        Font = Enum.Font.Gotham,
        Name = "SubTitle",
        ZIndex = 21
    })
    
    -- Tab Scroll
    local TabScroll = Create("ScrollingFrame", MainFrame, {
        Size = UDim2.new(0, bearlib.Save.TabSize, 1, -35),
        Position = UDim2.new(0, 0, 1, 0),
        AnchorPoint = Vector2.new(0, 1),
        ScrollBarThickness = 2,
        ScrollBarImageColor3 = Theme["Color Theme"],
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        AutomaticCanvasSize = "Y",
        ScrollingDirection = "Y",
        Name = "TabScroll",
        ZIndex = 20
    }, {
        Create("UIPadding", {PaddingLeft = UDim.new(0, 10), PaddingTop = UDim.new(0, 10), PaddingBottom = UDim.new(0, 10)}),
        Create("UIListLayout", {Padding = UDim.new(0, 6)})
    })
    
    local Containers = Create("Frame", MainFrame, {
        Size = UDim2.new(1, -bearlib.Save.TabSize, 1, -35),
        Position = UDim2.new(1, 0, 1, 0),
        AnchorPoint = Vector2.new(1, 1),
        BackgroundTransparency = 1,
        ClipsDescendants = true,
        Name = "Containers",
        ZIndex = 20
    })
    
    local ButtonsFolder = Create("Frame", TopBar, {
        Size = UDim2.new(0, 70, 1, 0),
        Position = UDim2.new(1, -15, 0),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundTransparency = 1,
        ZIndex = 25
    }, {
        Create("UIListLayout", {FillDirection = "Horizontal", HorizontalAlignment = "Right", VerticalAlignment = "Center", Padding = UDim.new(0, 8)})
    })
    
    local MinimizeButton = Create("ImageButton", ButtonsFolder, {
        Size = UDim2.new(0, 18, 0, 18),
        BackgroundTransparency = 1,
        Image = "rbxassetid://10734896206",
        ImageColor3 = Theme["Color Text"],
        Name = "Minimize",
        ZIndex = 25
    })
    
    local CloseButton = Create("ImageButton", ButtonsFolder, {
        Size = UDim2.new(0, 18, 0, 18),
        BackgroundTransparency = 1,
        Image = "rbxassetid://10747384394",
        ImageColor3 = Theme["Color Text"],
        Name = "Close",
        ZIndex = 25
    })
    
    local Window = {}
    local FirstTab = true
    local Minimized = false
    local SaveSize
    
    function Window:CloseBtn()
        ScreenGui:Destroy()
        local Toggle = CoreGui:FindFirstChild("BearHub_Toggle")
        if Toggle then Toggle:Destroy() end
    end
    
    function Window:MinimizeBtn()
        if Minimized then
            MinimizeButton.Image = "rbxassetid://10734896206"
            MainFrame.Size = SaveSize
            Minimized = false
        else
            MinimizeButton.Image = "rbxassetid://10734924532"
            SaveSize = MainFrame.Size
            MainFrame.Size = UDim2.fromOffset(MainFrame.Size.X.Offset, 35)
            Minimized = true
        end
    end
    
    CloseButton.Activated:Connect(Window.CloseBtn)
    MinimizeButton.Activated:Connect(Window.MinimizeBtn)
    
    -- ==================== TAB CREATION ====================
    function Window:MakeTab(Configs)
        local TName = Configs[1] or Configs.Title or "Tab"
        local TIcon = Configs[2] or Configs.Icon or ""
        
        local TabSelect = Create("TextButton", TabScroll, {
            Size = UDim2.new(1, 0, 0, 28),
            BackgroundColor3 = Theme["Color Hub 2"],
            AutoButtonColor = false,
            Text = "",
            ZIndex = 25
        })
        AddCorner(TabSelect, 8)
        
        local SelectedIndicator = Create("Frame", TabSelect, {
            Size = FirstTab and UDim2.new(0, 4, 0, 20) or UDim2.new(0, 4, 0, 4),
            Position = UDim2.new(0, 2, 0.5),
            AnchorPoint = Vector2.new(0, 0.5),
            BackgroundColor3 = Theme["Color Theme"],
            BackgroundTransparency = FirstTab and 0 or 1,
            ZIndex = 26
        })
        AddCorner(SelectedIndicator, 2)
        
        if TIcon ~= "" then
            Create("ImageLabel", TabSelect, {
                Position = UDim2.new(0, 8, 0.5),
                AnchorPoint = Vector2.new(0, 0.5),
                Size = UDim2.new(0, 16, 0, 16),
                Image = TIcon,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
        end
        
        local TabTitle = Create("TextLabel", TabSelect, {
            Position = TIcon ~= "" and UDim2.new(0, 28, 0.5) or UDim2.new(0, 8, 0.5),
            AnchorPoint = Vector2.new(0, 0.5),
            Size = UDim2.new(1, -30, 0.8, 0),
            Text = TName,
            TextColor3 = Theme["Color Text"],
            TextTransparency = FirstTab and 0 or 0.3,
            BackgroundTransparency = 1,
            TextXAlignment = "Left",
            TextSize = 12,
            Font = Enum.Font.GothamBold,
            ZIndex = 26
        })
        
        local Container = Create("ScrollingFrame", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            ScrollBarThickness = 2,
            ScrollBarImageColor3 = Theme["Color Theme"],
            AutomaticCanvasSize = "Y",
            ScrollingDirection = "Y",
            BorderSizePixel = 0,
            Name = TName .. "Container",
            ZIndex = 20
        }, {
            Create("UIPadding", {PaddingLeft = UDim.new(0, 10), PaddingRight = UDim.new(0, 10), PaddingTop = UDim.new(0, 10), PaddingBottom = UDim.new(0, 10)}),
            Create("UIListLayout", {Padding = UDim.new(0, 8)})
        })
        
        if not FirstTab then Container.Parent = nil else Container.Parent = Containers end
        
        local function SelectTab()
            Container.Parent = Containers
            for _, child in pairs(Containers:GetChildren()) do
                if child:IsA("ScrollingFrame") and child ~= Container then
                    child.Parent = nil
                end
            end
            TabTitle.TextTransparency = 0
            SelectedIndicator.Size = UDim2.new(0, 4, 0, 20)
            SelectedIndicator.BackgroundTransparency = 0
        end
        TabSelect.Activated:Connect(SelectTab)
        
        FirstTab = false
        
        local Tab = {}
        Tab.Container = Container
        
        -- Section
        local CurrentSection = nil
        
        function Tab:AddSection(config)
            local SectionName = type(config) == "string" and config or config.Name or config.Title or "Section"
            CurrentSection = SectionName
            
            local SectionFrame = Create("Frame", Container, {
                Size = UDim2.new(1, 0, 0, 24),
                BackgroundTransparency = 1,
                ZIndex = 25
            })
            
            Create("TextLabel", SectionFrame, {
                Position = UDim2.new(0, 8, 0.5),
                AnchorPoint = Vector2.new(0, 0.5),
                Size = UDim2.new(1, -20, 0.8, 0),
                Text = SectionName,
                TextColor3 = Theme["Color Text"],
                TextSize = 15,
                TextXAlignment = "Left",
                Font = Enum.Font.GothamBold,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
            
            Create("Frame", SectionFrame, {
                Size = UDim2.new(1, -20, 0, 2),
                Position = UDim2.new(0, 10, 1, -2),
                BackgroundColor3 = Theme["Color Stroke"],
                BackgroundTransparency = 0.5,
                ZIndex = 26
            })
        end
        
        -- Button
        function Tab:AddButton(config)
            local Name = config.Name or config[1] or "Button"
            local Desc = config.Desc or config.Description or ""
            local Callback = config.Callback or function() end
            
            local Button = Create("TextButton", Container, {
                Size = UDim2.new(1, 0, 0, Desc ~= "" and 40 or 30),
                BackgroundColor3 = Theme["Color Hub 2"],
                AutoButtonColor = false,
                Text = "",
                ZIndex = 25
            })
            AddCorner(Button, 6)
            AddStroke(Button, Theme["Color Stroke"], 1)
            
            Create("TextLabel", Button, {
                Position = UDim2.new(0, 10, Desc ~= "" and 0.35 or 0.5),
                AnchorPoint = Vector2.new(0, 0.5),
                Size = UDim2.new(0.7, 0, 0.8, 0),
                Text = Name,
                TextColor3 = Theme["Color Text"],
                TextXAlignment = "Left",
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
            
            if Desc ~= "" then
                Create("TextLabel", Button, {
                    Position = UDim2.new(0, 10, 0.8, 0),
                    AnchorPoint = Vector2.new(0, 0.5),
                    Size = UDim2.new(0.8, 0, 0, 12),
                    Text = Desc,
                    TextColor3 = Theme["Color Dark Text"],
                    TextXAlignment = "Left",
                    TextSize = 9,
                    Font = Enum.Font.Gotham,
                    BackgroundTransparency = 1,
                    ZIndex = 26
                })
            end
            
            Button.Activated:Connect(Callback)
        end
        
        -- Toggle
        function Tab:AddToggle(config)
            local Name = config.Name or config[1] or "Toggle"
            local Desc = config.Desc or config.Description or ""
            local Default = config.Default or false
            local Callback = config.Callback or function() end
            local Flag = config.Flag
            
            local Button = Create("TextButton", Container, {
                Size = UDim2.new(1, 0, 0, Desc ~= "" and 40 or 30),
                BackgroundColor3 = Theme["Color Hub 2"],
                AutoButtonColor = false,
                Text = "",
                ZIndex = 25
            })
            AddCorner(Button, 6)
            AddStroke(Button, Theme["Color Stroke"], 1)
            
            Create("TextLabel", Button, {
                Position = UDim2.new(0, 10, Desc ~= "" and 0.35 or 0.5),
                AnchorPoint = Vector2.new(0, 0.5),
                Size = UDim2.new(0.6, 0, 0.8, 0),
                Text = Name,
                TextColor3 = Theme["Color Text"],
                TextXAlignment = "Left",
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
            
            if Desc ~= "" then
                Create("TextLabel", Button, {
                    Position = UDim2.new(0, 10, 0.8, 0),
                    AnchorPoint = Vector2.new(0, 0.5),
                    Size = UDim2.new(0.7, 0, 0, 12),
                    Text = Desc,
                    TextColor3 = Theme["Color Dark Text"],
                    TextXAlignment = "Left",
                    TextSize = 9,
                    Font = Enum.Font.Gotham,
                    BackgroundTransparency = 1,
                    ZIndex = 26
                })
            end
            
            local ToggleFrame = Create("Frame", Button, {
                Position = UDim2.new(1, -35, 0.5),
                AnchorPoint = Vector2.new(1, 0.5),
                Size = UDim2.new(0, 30, 0, 16),
                BackgroundColor3 = Theme["Color Stroke"],
                BackgroundTransparency = 0.7,
                ZIndex = 27
            })
            AddCorner(ToggleFrame, 8)
            
            local Toggle = Create("Frame", ToggleFrame, {
                Size = UDim2.new(0, 12, 0, 12),
                Position = UDim2.new(Default and 1 or 0, Default and -2 or 2, 0.5),
                AnchorPoint = Vector2.new(Default and 1 or 0, 0.5),
                BackgroundColor3 = Theme["Color Theme"],
                ZIndex = 28
            })
            AddCorner(Toggle, 6)
            
            local state = Default
            local function SetState(val)
                state = val
                if val then
                    TweenService:Create(Toggle, TweenInfo.new(0.2), {Position = UDim2.new(1, -2, 0.5), AnchorPoint = Vector2.new(1, 0.5)}):Play()
                else
                    TweenService:Create(Toggle, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5), AnchorPoint = Vector2.new(0, 0.5)}):Play()
                end
                Callback(val)
            end
            
            Button.Activated:Connect(function() SetState(not state) end)
        end
        
        -- Dropdown
        function Tab:AddDropdown(config)
            local Name = config.Name or config[1] or "Dropdown"
            local Options = config.Options or {}
            local Default = config.Default or (Options[1] or "")
            local Callback = config.Callback or function() end
            
            local Button = Create("TextButton", Container, {
                Size = UDim2.new(1, 0, 0, 35),
                BackgroundColor3 = Theme["Color Hub 2"],
                AutoButtonColor = false,
                Text = "",
                ZIndex = 25
            })
            AddCorner(Button, 6)
            AddStroke(Button, Theme["Color Stroke"], 1)
            
            Create("TextLabel", Button, {
                Position = UDim2.new(0, 10, 0.5),
                AnchorPoint = Vector2.new(0, 0.5),
                Size = UDim2.new(0.5, 0, 0.8, 0),
                Text = Name,
                TextColor3 = Theme["Color Text"],
                TextXAlignment = "Left",
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
            
            local ValueLabel = Create("TextLabel", Button, {
                Position = UDim2.new(0.9, -10, 0.5),
                AnchorPoint = Vector2.new(1, 0.5),
                Size = UDim2.new(0.3, 0, 0.8, 0),
                Text = Default,
                TextColor3 = Theme["Color Theme"],
                TextSize = 11,
                Font = Enum.Font.GothamBold,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
        end
        
        -- Paragraph
        function Tab:AddParagraph(config)
            local Title = config.Title or config[1] or "Info"
            local Content = config.Content or config.Desc or config[2] or ""
            
            local Frame = Create("Frame", Container, {
                Size = UDim2.new(1, 0, 0, 40),
                BackgroundColor3 = Theme["Color Hub 2"],
                ZIndex = 25
            })
            AddCorner(Frame, 6)
            AddStroke(Frame, Theme["Color Stroke"], 1)
            
            Create("TextLabel", Frame, {
                Position = UDim2.new(0, 10, 0.3),
                AnchorPoint = Vector2.new(0, 0.5),
                Size = UDim2.new(1, -20, 0, 15),
                Text = Title,
                TextColor3 = Theme["Color Text"],
                TextXAlignment = "Left",
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
            
            local DescLabel = Create("TextLabel", Frame, {
                Position = UDim2.new(0, 10, 0.7),
                AnchorPoint = Vector2.new(0, 0.5),
                Size = UDim2.new(1, -20, 0, 14),
                Text = Content,
                TextColor3 = Theme["Color Dark Text"],
                TextXAlignment = "Left",
                TextSize = 10,
                Font = Enum.Font.Gotham,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
        end
        
        -- TextBox
        function Tab:AddTextBox(config)
            local Name = config.Name or config[1] or "Input"
            local Placeholder = config.Placeholder or config.PlaceHolder or "Enter..."
            local Default = config.Default or ""
            local Callback = config.Callback or function() end
            
            local Frame = Create("Frame", Container, {
                Size = UDim2.new(1, 0, 0, 40),
                BackgroundColor3 = Theme["Color Hub 2"],
                ZIndex = 25
            })
            AddCorner(Frame, 6)
            AddStroke(Frame, Theme["Color Stroke"], 1)
            
            Create("TextLabel", Frame, {
                Position = UDim2.new(0, 10, 0.25),
                AnchorPoint = Vector2.new(0, 0.5),
                Size = UDim2.new(1, -20, 0, 15),
                Text = Name,
                TextColor3 = Theme["Color Text"],
                TextXAlignment = "Left",
                TextSize = 11,
                Font = Enum.Font.GothamBold,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
            
            local BoxFrame = Create("Frame", Frame, {
                Position = UDim2.new(0.5, 0, 0.7, 0),
                AnchorPoint = Vector2.new(0.5, 0.5),
                Size = UDim2.new(0.9, 0, 0, 22),
                BackgroundColor3 = Theme["Color Hub 2"],
                ZIndex = 27
            })
            AddCorner(BoxFrame, 4)
            AddStroke(BoxFrame, Theme["Color Stroke"], 1)
            
            local Box = Create("TextBox", BoxFrame, {
                Size = UDim2.new(1, -8, 1, 0),
                Position = UDim2.new(0, 4, 0, 0),
                BackgroundTransparency = 1,
                Text = Default,
                PlaceholderText = Placeholder,
                TextColor3 = Theme["Color Text"],
                TextSize = 11,
                Font = Enum.Font.Gotham,
                ClearTextOnFocus = false,
                ZIndex = 28
            })
            
            Box.FocusLost:Connect(function() Callback(Box.Text) end)
        end
        
        -- Discord Invite
        function Tab:AddDiscordInvite(config)
            if type(config[1]) == "table" then
                -- Multiple cards
                for i, card in ipairs(config) do
                    local Title = card[1] or "Discord"
                    local Desc = card[2] or ""
                    local Icon = card[3] or "rbxassetid://134852113716171"
                    local Invite = card[7] or "https://discord.gg/"
                    
                    local Frame = Create("Frame", Container, {
                        Size = UDim2.new(1, 0, 0, 80),
                        BackgroundColor3 = Theme["Color Hub 2"],
                        ZIndex = 25
                    })
                    AddCorner(Frame, 8)
                    AddStroke(Frame, Theme["Color Stroke"], 1.5)
                    
                    Create("ImageLabel", Frame, {
                        Size = UDim2.new(0, 32, 0, 32),
                        Position = UDim2.new(0, 10, 0.5),
                        AnchorPoint = Vector2.new(0, 0.5),
                        Image = Icon,
                        BackgroundTransparency = 1,
                        ZIndex = 26
                    })
                    
                    Create("TextLabel", Frame, {
                        Position = UDim2.new(0, 50, 0, 20),
                        Size = UDim2.new(0.5, 0, 0, 16),
                        Text = Title,
                        TextColor3 = Theme["Color Text"],
                        TextSize = 12,
                        Font = Enum.Font.GothamBold,
                        TextXAlignment = "Left",
                        BackgroundTransparency = 1,
                        ZIndex = 26
                    })
                    
                    Create("TextLabel", Frame, {
                        Position = UDim2.new(0, 50, 0, 38),
                        Size = UDim2.new(0.5, 0, 0, 20),
                        Text = Desc,
                        TextColor3 = Theme["Color Dark Text"],
                        TextSize = 9,
                        TextWrapped = true,
                        TextXAlignment = "Left",
                        BackgroundTransparency = 1,
                        ZIndex = 26
                    })
                    
                    local JoinBtn = Create("TextButton", Frame, {
                        Position = UDim2.new(0.9, 0, 0.5),
                        AnchorPoint = Vector2.new(0.5, 0.5),
                        Size = UDim2.new(0, 60, 0, 28),
                        Text = "JOIN",
                        TextColor3 = Color3.fromRGB(255, 255, 255),
                        TextSize = 11,
                        Font = Enum.Font.GothamBold,
                        BackgroundColor3 = Theme["Color Theme"],
                        ZIndex = 27
                    })
                    AddCorner(JoinBtn, 14)
                    
                    JoinBtn.Activated:Connect(function()
                        setclipboard(Invite)
                        JoinBtn.Text = "COPIED!"
                        task.wait(2)
                        JoinBtn.Text = "JOIN"
                    end)
                end
            else
                -- Single card
                local Title = config[1] or "Discord"
                local Desc = config[2] or ""
                local Icon = config[3] or "rbxassetid://134852113716171"
                local Invite = config[4] or "https://discord.gg/"
                
                local Frame = Create("Frame", Container, {
                    Size = UDim2.new(1, 0, 0, 80),
                    BackgroundColor3 = Theme["Color Hub 2"],
                    ZIndex = 25
                })
                AddCorner(Frame, 8)
                AddStroke(Frame, Theme["Color Stroke"], 1.5)
                
                Create("ImageLabel", Frame, {
                    Size = UDim2.new(0, 32, 0, 32),
                    Position = UDim2.new(0, 10, 0.5),
                    AnchorPoint = Vector2.new(0, 0.5),
                    Image = Icon,
                    BackgroundTransparency = 1,
                    ZIndex = 26
                })
                
                Create("TextLabel", Frame, {
                    Position = UDim2.new(0, 50, 0, 20),
                    Size = UDim2.new(0.5, 0, 0, 16),
                    Text = Title,
                    TextColor3 = Theme["Color Text"],
                    TextSize = 12,
                    Font = Enum.Font.GothamBold,
                    TextXAlignment = "Left",
                    BackgroundTransparency = 1,
                    ZIndex = 26
                })
                
                Create("TextLabel", Frame, {
                    Position = UDim2.new(0, 50, 0, 38),
                    Size = UDim2.new(0.5, 0, 0, 20),
                    Text = Desc,
                    TextColor3 = Theme["Color Dark Text"],
                    TextSize = 9,
                    TextWrapped = true,
                    TextXAlignment = "Left",
                    BackgroundTransparency = 1,
                    ZIndex = 26
                })
                
                local JoinBtn = Create("TextButton", Frame, {
                    Position = UDim2.new(0.9, 0, 0.5),
                    AnchorPoint = Vector2.new(0.5, 0.5),
                    Size = UDim2.new(0, 60, 0, 28),
                    Text = "JOIN",
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    TextSize = 11,
                    Font = Enum.Font.GothamBold,
                    BackgroundColor3 = Theme["Color Theme"],
                    ZIndex = 27
                })
                AddCorner(JoinBtn, 14)
                
                JoinBtn.Activated:Connect(function()
                    setclipboard(Invite)
                    JoinBtn.Text = "COPIED!"
                    task.wait(2)
                    JoinBtn.Text = "JOIN"
                end)
            end
        end
        
        -- Profile
        function Tab:AddProfile(config)
            local Name = config.Name or "User"
            local Bio = config.Bio or ""
            local Avatar = config.Avatar or "rbxassetid://134852113716171"
            local Verified = config.Verified or false
            
            local Frame = Create("Frame", Container, {
                Size = UDim2.new(1, 0, 0, 70),
                BackgroundColor3 = Theme["Color Hub 2"],
                ZIndex = 25
            })
            AddCorner(Frame, 8)
            AddStroke(Frame, Theme["Color Stroke"], 1.5)
            
            Create("ImageLabel", Frame, {
                Size = UDim2.new(0, 45, 0, 45),
                Position = UDim2.new(0, 10, 0.5),
                AnchorPoint = Vector2.new(0, 0.5),
                Image = Avatar,
                BackgroundTransparency = 1,
                ZIndex = 26
            })
            AddCorner(Create("ImageLabel"), 23)
            
            Create("TextLabel", Frame, {
                Position = UDim2.new(0, 65, 0, 20),
                Size = UDim2.new(0.7, 0, 0, 16),
                Text = Name,
                TextColor3 = Theme["Color Text"],
                TextSize = 13,
                Font = Enum.Font.GothamBold,
                TextXAlignment = "Left",
                BackgroundTransparency = 1,
                ZIndex = 26
            })
            
            Create("TextLabel", Frame, {
                Position = UDim2.new(0, 65, 0, 38),
                Size = UDim2.new(0.7, 0, 0, 14),
                Text = Bio,
                TextColor3 = Theme["Color Dark Text"],
                TextSize = 10,
                TextXAlignment = "Left",
                BackgroundTransparency = 1,
                ZIndex = 26
            })
            
            if Verified then
                Create("ImageLabel", Frame, {
                    Size = UDim2.new(0, 14, 0, 14),
                    Position = UDim2.new(0, 65 + (string.len(Name) * 6), 0, 21),
                    Image = "rbxassetid://10709752907",
                    ImageColor3 = Theme["Color Theme"],
                    BackgroundTransparency = 1,
                    ZIndex = 27
                })
            end
        end
        
        return Tab
    end
    
    -- Toggle button
    local ToggleGui = Instance.new("ScreenGui")
    ToggleGui.Name = "BearHub_Toggle"
    ToggleGui.Parent = CoreGui
    
    local ToggleBtn = Instance.new("ImageButton")
    ToggleBtn.Size = UDim2.new(0, 50, 0, 50)
    ToggleBtn.Position = UDim2.new(0.15, 0, 0.15, 0)
    ToggleBtn.Image = "rbxassetid://115377474207871"
    ToggleBtn.BackgroundTransparency = 1
    ToggleBtn.Draggable = true
    ToggleBtn.Parent = ToggleGui
    
    AddCorner(ToggleBtn, 25)
    AddStroke(ToggleBtn, Theme["Color Stroke"], 2)
    
    ToggleBtn.MouseButton1Click:Connect(function()
        MainFrame.Visible = not MainFrame.Visible
    end)
    
    return Window
end

-- Toast Notification
local ToastContainer = ScreenGui:FindFirstChild("ToastContainer")
if not ToastContainer then
    ToastContainer = Instance.new("Frame")
    ToastContainer.Name = "ToastContainer"
    ToastContainer.Size = UDim2.new(0, 300, 1, -20)
    ToastContainer.Position = UDim2.new(1, -310, 0, 10)
    ToastContainer.BackgroundTransparency = 1
    ToastContainer.Parent = ScreenGui
    ToastContainer.ZIndex = 100
    
    local ToastListLayout = Instance.new("UIListLayout")
    ToastListLayout.SortOrder = "LayoutOrder"
    ToastListLayout.HorizontalAlignment = "Right"
    ToastListLayout.VerticalAlignment = "Bottom"
    ToastListLayout.Padding = UDim.new(0, 8)
    ToastListLayout.Parent = ToastContainer
end

function bearlib:Notify(text, duration)
    duration = duration or 3
    
    local ToastFrame = Instance.new("Frame")
    ToastFrame.Size = UDim2.new(0, 280, 0, 0)
    ToastFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    ToastFrame.ClipsDescendants = true
    ToastFrame.LayoutOrder = -tick()
    ToastFrame.Parent = ToastContainer
    ToastFrame.ZIndex = 101
    AddCorner(ToastFrame, 14)
    AddStroke(ToastFrame, Theme["Color Stroke"], 2)
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -20, 0, 18)
    Title.Position = UDim2.new(0, 10, 0, 8)
    Title.Text = "BEAR HUB"
    Title.Font = Enum.Font.GothamBold
    Title.TextColor3 = Theme["Color Theme"]
    Title.TextSize = 14
    Title.TextXAlignment = "Left"
    Title.BackgroundTransparency = 1
    Title.Parent = ToastFrame
    
    local Msg = Instance.new("TextLabel")
    Msg.Size = UDim2.new(1, -20, 0, 30)
    Msg.Position = UDim2.new(0, 10, 0, 28)
    Msg.Text = text
    Msg.Font = Enum.Font.Gotham
    Msg.TextColor3 = Theme["Color Dark Text"]
    Msg.TextSize = 12
    Msg.TextWrapped = true
    Msg.BackgroundTransparency = 1
    Msg.Parent = ToastFrame
    
    local TimeText = Instance.new("TextLabel")
    TimeText.Size = UDim2.new(0, 40, 0, 16)
    TimeText.Position = UDim2.new(1, -45, 0, 8)
    TimeText.Text = tostring(duration)
    TimeText.Font = Enum.Font.FredokaOne
    TimeText.TextColor3 = Theme["Color Text"]
    TimeText.TextSize = 14
    TimeText.BackgroundTransparency = 1
    TimeText.Parent = ToastFrame
    
    local Progress = Instance.new("Frame")
    Progress.Size = UDim2.new(1, -20, 0, 3)
    Progress.Position = UDim2.new(0, 10, 0, 62)
    Progress.BackgroundColor3 = Theme["Color Stroke"]
    Progress.BackgroundTransparency = 0.7
    Progress.Parent = ToastFrame
    AddCorner(Progress, 1)
    
    local ProgressBar = Instance.new("Frame")
    ProgressBar.Size = UDim2.new(1, 0, 1, 0)
    ProgressBar.BackgroundColor3 = Theme["Color Theme"]
    ProgressBar.Parent = Progress
    AddCorner(ProgressBar, 1)
    
    ToastFrame.Size = UDim2.new(0, 280, 0, 75)
    
    local remaining = duration
    local connection
    
    local function Update()
        remaining = remaining - 0.1
        if remaining <= 0 then
            connection:Disconnect()
            ToastFrame:Destroy()
        else
            TimeText.Text = tostring(math.ceil(remaining))
            ProgressBar.Size = UDim2.new(remaining / duration, 0, 1, 0)
        end
    end
    
    connection = RunService.Heartbeat:Connect(Update)
end

function bearlib:ShowToast(text, duration)
    self:Notify(text, duration)
end

print("[BEARLIB] Loaded - Compatible with Abacaxi Hub")
return bearlib